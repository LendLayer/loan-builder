!function(a){"use strict";function b(a){var b,c,d,e;if(!a)return a;for(c=arguments.length,b=1;c>b;b++)if(d=arguments[b])for(e in d)a[e]=d[e];return a}var c=a.d3,d=Object.hasOwnProperty,e=function(a,b){if(!a)throw Error("[d3.chart] "+b)};e(c,"d3.js is required"),e("string"==typeof c.version&&c.version.match(/^3/),"d3.js version 3 is required");var f=/^(enter|update|merge|exit)(:transition)?$/,g=function(a){e(a,"Layers must be initialized with a base."),this._base=a,this._handlers={}};g.prototype.dataBind=function(){e(!1,"Layers must specify a `dataBind` method.")},g.prototype.insert=function(){e(!1,"Layers must specify an `insert` method.")},g.prototype.on=function(a,b,c){return c=c||{},e(f.test(a),"Unrecognized lifecycle event name specified to `Layer#on`: '"+a+"'."),a in this._handlers||(this._handlers[a]=[]),this._handlers[a].push({callback:b,chart:c.chart||null}),this._base},g.prototype.off=function(a,b){var c,d=this._handlers[a];if(e(f.test(a),"Unrecognized lifecycle event name specified to `Layer#off`: '"+a+"'."),!d)return this._base;if(1===arguments.length)return d.length=0,this._base;for(c=d.length-1;c>-1;--c)d[c].callback===b&&d.splice(c,1);return this._base},g.prototype.draw=function(a){var b,d,f,g,h,i,j,k;b=this.dataBind.call(this._base,a),e(b&&b.call===c.selection.prototype.call,"Invalid selection defined by `Layer#dataBind` method."),e(b.enter,"Layer selection not properly bound."),d=b.enter(),d._chart=this._base._chart,f=[{name:"update",selection:b},{name:"enter",selection:this.insert.bind(d)},{name:"merge",selection:b},{name:"exit",selection:b.exit.bind(b)}];for(var l=0,m=f.length;m>l;++l)if(i=f[l].name,g=f[l].selection,"function"==typeof g&&(g=g()),!g.empty()){if(e(g&&g.call===c.selection.prototype.call,"Invalid selection defined for '"+i+"' lifecycle event."),h=this._handlers[i])for(j=0,k=h.length;k>j;++j)g._chart=h[j].chart||this._base._chart,g.call(h[j].callback);if(h=this._handlers[i+":transition"],h&&h.length)for(g=g.transition(),j=0,k=h.length;k>j;++j)g._chart=h[j].chart||this._base._chart,g.call(h[j].callback)}},c.selection.prototype.layer=function(a){var b,c=new g(this);if(c.dataBind=a.dataBind,c.insert=a.insert,"events"in a)for(b in a.events)c.on(b,a.events[b]);return this.on=function(){return c.on.apply(c,arguments)},this.off=function(){return c.off.apply(c,arguments)},this.draw=function(){return c.draw.apply(c,arguments)},this};var h=function(a,b){var c=this.constructor,e=c.__super__;e&&h.call(e,a,b),d.call(c.prototype,"initialize")&&this.initialize.apply(a,b)},i=function(a,b){var c=this.constructor,e=c.__super__;return this===a&&d.call(this,"transform")&&(b=this.transform(b)),d.call(c.prototype,"transform")&&(b=c.prototype.transform.call(a,b)),e&&(b=i.call(e,a,b)),b},j=function(a,b){this.base=a,this._layers={},this._attached={},this._events={},b&&b.transform&&(this.transform=b.transform),h.call(this,this,[b])};j.prototype.initialize=function(){},j.prototype.unlayer=function(a){var b=this.layer(a);return delete this._layers[a],delete b._chart,b},j.prototype.layer=function(a,b,c){var d;if(1===arguments.length)return this._layers[a];if(2===arguments.length){if("function"==typeof b.draw)return b._chart=this,this._layers[a]=b,this._layers[a];e(!1,"When reattaching a layer, the second argument must be a d3.chart layer")}return d=b.layer(c),this._layers[a]=d,b._chart=this,d},j.prototype.attach=function(a,b){return 1===arguments.length?this._attached[a]:(this._attached[a]=b,b)},j.prototype.draw=function(a){var b,c,d;a=i.call(this,this,a);for(b in this._layers)this._layers[b].draw(a);for(c in this._attached)d=this.demux?this.demux(c,a):a,this._attached[c].draw(d)},j.prototype.on=function(a,b,c){var d=this._events[a]||(this._events[a]=[]);return d.push({callback:b,context:c||this,_chart:this}),this},j.prototype.once=function(a,b,c){var d=this,e=function(){d.off(a,e),b.apply(this,arguments)};return this.on(a,e,c)},j.prototype.off=function(a,b,c){var d,e,f,g,h,i;if(0===arguments.length){for(a in this._events)this._events[a].length=0;return this}if(1===arguments.length)return f=this._events[a],f&&(f.length=0),this;for(d=a?[a]:Object.keys(this._events),h=0;d.length>h;h++)for(e=d[h],f=this._events[e],i=f.length;i--;)g=f[i],(b&&b===g.callback||c&&c===g.context)&&f.splice(i,1);return this},j.prototype.trigger=function(a){var b,c,d=Array.prototype.slice.call(arguments,1),e=this._events[a];if(void 0!==e)for(b=0;e.length>b;b++)c=e[b],c.callback.apply(c.context,d);return this},j.extend=function(a,c,e){var f,g=this;f=c&&d.call(c,"constructor")?c.constructor:function(){return g.apply(this,arguments)},b(f,g,e);var h=function(){this.constructor=f};return h.prototype=g.prototype,f.prototype=new h,c&&b(f.prototype,c),f.__super__=g.prototype,j[a]=f,f},c.chart=function(a){return 0===arguments.length?j:1===arguments.length?j[a]:j.extend.apply(j,arguments)},c.selection.prototype.chart=function(a,b){if(0===arguments.length)return this._chart;var c=j[a];return e(c,"No chart registered with name '"+a+"'"),new c(this,b)},c.selection.enter.prototype.chart=function(){return this._chart},c.transition.prototype.chart=c.selection.enter.prototype.chart}(this),function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t=function(a,b){return function(){return a.apply(b,arguments)}};angular.module("insightFellowsApp",["ngCookies","ngResource","ngSanitize","uiSlider","ui.bootstrap"]),d3.chart("PaymentsChart",{initialize:function(){var a,b;return a=this,this.base.classed("payments-chart",!0),this.w=this.base.attr("width")||parseInt(this.base.style("width"))||600,this.h=this.base.attr("height")||parseInt(this.base.style("height"))||400,this.margins={top:20,bottom:40,left:80,right:0,bar_padding:10},this.x=d3.scale.linear().range([0,this.w-this.margins.left]),this.y=d3.scale.linear().range([this.h-this.margins.bottom,0]),this.areas={},this.areas.xlabels=this.base.append("g").classed("xlabels",!0).attr("width",this.w-this.margins.left).attr("height",this.margins.bottom).attr("transform","translate("+this.margins.left+","+(this.h-this.margins.bottom)+")"),this.areas.ylabels=this.base.append("g").classed("ylabels",!0).attr("width",this.margins.left).attr("height",this.h-this.margins.bottom-this.margins.top).attr("transform","translate("+(this.margins.left-1)+","+this.margins.top+")"),this.areas.plot=this.base.append("g").classed("plot",!0).attr("width",this.w-this.margins.left).attr("height",this.h-this.margins.bottom-this.margins.top).attr("transform","translate("+this.margins.left+","+(20+this.margins.top)+")"),this.layer("bars",this.areas.plot,{dataBind:function(a){return this.selectAll("rect").data(a)},insert:function(){return this.append("rect").classed("bar",!0)}}),this.layer("xlabels",this.areas.xlabels,{dataBind:function(b){return this.append("line").attr("x1",0).attr("x2",a.w-a.margins.left).attr("y1",0).attr("y2",0).style("stroke-width","1").style("shape-rendering","crispEdges"),this.selectAll("text").data(b)},insert:function(){return this.append("text").classed("label",!0).attr("text-anchor","middle").attr("x",function(b,c){return a.x(c)-.5+a.bar_width/2}).attr("dy","1em").text(function(a){return a.name})}}),b=function(){return this.attr("x",function(b,c){return a.x(c)-.5}).attr("y",function(b){return a.h-a.margins.bottom-a.margins.top-a.y(a.datamax-b)-.5}).attr("val",function(a){return a}).attr("width",a.bar_width).attr("height",function(b){return 1+a.y(a.datamax-b)})},this.layer("bars").on("enter",b),this.layer("bars").on("update",b)},transform:function(a){var b;return this.data=a,this.bars=a.length,this.bar_width=(this.w-this.margins.left-(this.bars-1)*this.margins.bar_padding)/this.bars,this.x.domain([0,this.bars]),this.datamax=this.usermax||d3.max(a,function(a){return a}),this.y.domain([0,this.datamax]),b=d3.svg.axis().scale(this.y).orient("left").ticks(4).tickFormat(function(a){return"$"+a}),this.displayYAxis&&this.areas.ylabels.call(b),a},max:function(a){return arguments.length?(this.usermax=a,this.data&&this.draw(this.data),this):this.usermax},width:function(a){return arguments.length?(this.w=a,this.x=d3.scale.linear().range([this.margins.left,this.w-this.margins.right]),this.base.attr("width",this.w),this.draw(this.data),this):this.w},height:function(a){return arguments.length?(this.h=a,this.y=d3.scale.linear().range([this.h-this.margins.top,this.margins.bottom]),this.base.attr("height",this.h),this.draw(this.data),this):this.h},displayYAxis:function(a){return arguments.length?(this.displayYAxis=a,this):this.displayYAxis}}),b="uiSlider",c="slider",d=function(a){return angular.element(a)},n=function(a){return""+a+"px"},h=function(a){return a.css({opacity:0})},q=function(a){return a.css({opacity:1})},k=function(a,b){return a.css({left:b})},g=function(a){return a[0].offsetWidth/2},l=function(a){return a[0].offsetLeft},s=function(a){return a[0].offsetWidth},f=function(a,b){return l(b)-l(a)-s(a)},e=function(a,b){return a.attr("ng-bind-html-unsafe",b)},p=function(a,b,c,d){var e,f,g,h;return null==d&&(d=0),null==c&&(c=1/Math.pow(10,b)),f=(a-d)%c,h=f>c/2?a+c-f:a-f,e=Math.pow(10,b),g=h*e/e,g.toFixed(b)},i={mouse:{start:"mousedown",move:"mousemove",end:"mouseup"},touch:{start:"touchstart",move:"touchmove",end:"touchend"}},r=function(a){return{restrict:"EA",scope:{floor:"@",ceiling:"@",step:"@",precision:"@",ngModel:"=?",ngModelLow:"=?",ngModelHigh:"=?",translate:"&"},template:'<span class="bar"></span><span class="bar selection"></span><span class="pointer"></span><span class="pointer"></span><span class="bubble selection"></span><span ng-bind-html-unsafe="translate({value: floor})" class="bubble limit"></span><span ng-bind-html-unsafe="translate({value: ceiling})" class="bubble limit"></span><span class="bubble"></span><span class="bubble"></span><span class="bubble"></span>',compile:function(b,c){var j,m,o,r,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H;if(c.translate&&c.$set("translate",""+c.translate+"(value)"),y=null==c.ngModel&&null!=c.ngModelLow&&null!=c.ngModelHigh,G=function(){var a,c,e,f;for(e=b.children(),f=[],a=0,c=e.length;c>a;a++)o=e[a],f.push(d(o));return f}(),t=G[0],B=G[1],x=G[2],w=G[3],C=G[4],r=G[5],j=G[6],v=G[7],u=G[8],m=G[9],A=y?"ngModelLow":"ngModel",z="ngModelHigh",e(C,"'Range: ' + translate({value: diff})"),e(v,"translate({value: "+A+"})"),e(u,"translate({value: "+z+"})"),e(m,"translate({value: "+A+"}) + ' - ' + translate({value: "+z+"})"),!y)for(H=[B,w,C,u,m],E=0,F=H.length;F>E;E++)b=H[E],b.remove();return D=[A,"floor","ceiling"],y&&D.push(z),{post:function(b,c,e){var o,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S;for(E=!1,K=d(document),e.translate||(b.translate=function(a){return a.value}),N="default",angular.isUndefined(e.sliderStyleNone)||(N=null),M=o=I=G=J=H=P=L=void 0,F=function(){var a,c,d;for(null==b.precision&&(b.precision=0),null==b.step&&(b.step=1),c=0,d=D.length;d>c;c++)a=D[c],b[a]=p(parseFloat(b[a]),parseInt(b.precision),parseFloat(b.step),parseFloat(b.floor));return b.diff=p(b[z]-b[A],parseInt(b.precision),parseFloat(b.step),parseFloat(b.floor)),M=g(x),o=s(t),I=0,G=o-s(x),J=parseFloat(e.floor),H=parseFloat(e.ceiling),P=H-J,L=G-I},O=function(){var a,d,e,t,D,H,N,O;return F(),t=function(a){return(a-I)/L*100},H=function(a){return(a-J)/P*100},D=function(a){return n(a*L/100)},e=function(a){return k(a,n(Math.min(Math.max(0,l(a)),o-s(a))))},O=function(){var a,c;return k(j,n(o-s(j))),c=H(b[A]),k(x,D(c)),k(v,n(l(x)-g(v)+M)),y?(a=H(b[z]),k(w,D(a)),k(u,n(l(w)-g(u)+M)),k(B,n(l(x)+M)),B.css({width:D(a-c)}),k(C,n(l(B)+g(B)-g(C))),k(m,n(l(B)+g(B)-g(m)))):void 0},a=function(){var a;return e(v),a=u,y&&(e(u),e(C),f(v,u)<10?(h(v),h(u),e(m),q(m),a=m):(q(v),q(u),h(m),a=u)),f(r,v)<5?h(r):y&&f(r,a)<5?h(r):q(r),f(v,j)<5?h(j):y&&f(a,j)<5?h(j):q(j)},d=function(a,d,e){var f,g,h;return f=function(){return a.removeClass("active"),K.unbind(e.move),K.unbind(e.end)},g=function(a){var e,f,g,h;return e=a.clientX||a.touches[0].clientX,f=e-c[0].getBoundingClientRect().left-M,f=Math.max(Math.min(f,G),I),g=t(f),h=J+P*g/100,y&&(d===A?h>b[z]&&(d=z,x.removeClass("active"),w.addClass("active")):h<b[A]&&(d=A,w.removeClass("active"),x.addClass("active"))),h=p(h,parseInt(b.precision),parseFloat(b.step),parseFloat(b.floor)),b[d]=h,b.$apply()},h=function(b){return a.addClass("active"),F(),b.stopPropagation(),b.preventDefault(),K.bind(e.move,g),K.bind(e.end,f)},a.bind(e.start,h)},N=function(){var a,b,c,e,f,g;for(E=!0,a=function(a){return d(x,A,i[a]),d(w,z,i[a])},f=["touch","mouse"],g=[],c=0,e=f.length;e>c;c++)b=f[c],g.push(a(b));return g},O(),a(),E?void 0:N()},a(O),R=0,S=D.length;S>R;R++)Q=D[R],b.$watch(Q,O);return window.addEventListener("resize",O),N?c.addClass(N):void 0}}}}},o=["$timeout",r],j=function(a,d){return d.module(b,[]).directive(c,o)},j(window,window.angular),angular.module("insightFellowsApp").directive("paymentsChart",function(){return{restrict:"E",replace:!0,scope:{loan:"="},template:"<svg></svg>",link:function(a,b){var c;return c=d3.select(b[0]).chart("PaymentsChart"),a.$watch("loan",function(a){return c.draw(a.balances())})}}}),angular.module("insightFellowsApp").controller("MainCtrl",["$scope",function(b){return b.loanInfo={amount:"2000",graceMonths:"4",payments:"8",interestRate:"6.5"},b.$watchCollection("loanInfo",function(c){var d;return d=m(c),b.loan=new a(d,c.interestRate)})}]),a=function(){function a(a,b){this.schedule=a,this.rate=b,this.netPresentValue=t(this.netPresentValue,this)}return a.prototype.netPresentValue=function(a,b){var c;return c=1/(1+this.rate/100),a*Math.pow(c,b/12)},a.prototype.balances=function(){var a,b,c,d,e,f;for(a=0,e=this.schedule,f=[],c=0,d=e.length;d>c;c++)b=e[c],f.push(a+=b);return f},a.prototype.cost=function(){var a,b,c;return c=function(){var c,d,e,f;for(e=this.schedule,f=[],b=c=0,d=e.length;d>c;b=++c)a=e[b],f.push(this.netPresentValue(a,b));return f}.call(this),c.reduce(function(a,b){return a+b})},a.prototype.maxMonthlyPayment=function(){return-Math.min.apply(Math,this.schedule)},a}(),m=function(a){var b,c,d,e,f,g;if(b=+a.amount,d=+a.payments,c=+a.graceMonths,a.installments)e=function(){var a,d;for(d=[],a=0;c>=0?c>=a:a>=c;c>=0?a++:a--)d.push(b/(c+1));return d}();else for(e=[b],f=0;c>=0?c>f:f>c;c>=0?f++:f--)e.push(0);for(g=0;d>=0?d>g:g>d;d>=0?g++:g--)e.push(-b/d);return e}}.call(this);